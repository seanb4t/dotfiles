#!/bin/bash

# {{ include "private_Library/LaunchAgents/dev.fzymgc.1password-agent-proxy.plist" | sha256sum }}

PLIST="$HOME/Library/LaunchAgents/dev.fzymgc.1password-agent-proxy.plist"
LABEL="dev.fzymgc.1password-agent-proxy"

# Skip loading when running inside an SSH session.
if [[ -n "${SSH_CONNECTION:-}" || -n "${SSH_TTY:-}" || -n "${SSH_CLIENT:-}" ]]; then
  echo "Skipping 1Password agent proxy load in SSH session"
  exit 0
fi

# Ensure target directory exists
mkdir -p "$HOME/.1password"

# Unload if already loaded (suppress errors if not loaded)
launchctl bootout "gui/$(id -u)/$LABEL" 2>/dev/null || true

# Load the agent
launchctl bootstrap "gui/$(id -u)" "$PLIST"

echo "1Password agent proxy loaded"
